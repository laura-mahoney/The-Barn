{% extends 'base.html' %}
{% block content %}

<br>Welcome to The Barn {{ crew.fname }}<br>

Latest Notes from {{ recent_notes.date_time }}:<br>{{ recent_notes.notes }}<br>

<form action="/addnotes" method="POST">
    <br>
    <div id="shiftTime">
        <input type="date" name="date">
        <input type="time" name="time">
    </div>
    <div id="shiftDuration">
        <select name="duration_shift">
            <option value="Duration" name="duration">Duration</option>
            <option value="1 hour" name="duration">1 hour</option>
            <option value="2 hours" name="duration">2 hours</option>
            <option value="3 hours" name="duration">3 hours</option>
            <option value="4 hours" name="duration">4 hours</option>
        </select>
    </div>
    <div id="otherCrew">
        <select name="crew_name">
                <option value="support">Support</option>
            {% for crew in all_crew %}
                <option value="{{ crew.fname }}">{{ crew.fname }}</option>
            {% endfor %}
        </select>
    </div>
    <input type="submit" name="createshift" value="Add Shift Notes"><br>
</form>


<div class="dogFriendGraph">
    <script src="https://d3js.org/d3.v4.min.js"></script>
        <script> 

        function makeTreeGraph(data){
            var dogNodes = data.dog_nodes;
            var dogLinks = data.dog_links;
            

            console.log(dogNodes);
            console.log(dogLinks);   

            var width = 800;
            var height = 600;

            var svg = d3.select('body')
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            var force = d3.forceSimulation(d3.values(dogNodes))
                .force("link", d3.forceLink(dogLinks).distance(100))
                .force("center", d3.forceCenter(width / 2, height/ 2))
                .force("charge", d3.forceManyBody().strength(-2));

            var link = svg.selectAll('.link')
                .data(dogLinks)
                .enter() 
                .append('line')
                .attr('class', 'link');

            var node = svg.selectAll('.node')
                .data(force.nodes())
                .enter()
                .append('g')
                .attr('class', 'node');

            var color = d3.scaleOrdinal(d3.schemeCategory10);

            node.append("circle")
                .attr("r", 10)
                .style("fill", function (d) {
                    console.log(d.source);
                    return color(d.source);
                });

            node.append("text").text(function (d) {
                return d.node;
            });

            force.on('end', function () {

                node.attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                });


                link.attr('x1', function (d) {
                        return d.source.x;
                    })
                    .attr('y1', function (d) {
                        return d.source.y;
                    })
                    .attr('x2', function (d) {
                        return d.target.x;
                    })
                    .attr('y2', function (d) {
                        return d.target.y;
                    });

                });
            };


    </script>
</div>


<br>
{% for dog in dogs %}

   <div>
    <h3>
        <p class="dogProfile" data-dog="{{ dog.dog_id }}" style="display: none">{{ dog.dog_name }}</p>
        </h3>
   </div>
   
   <img src= "static/images/{{ dog.dog_name }}.jpg" id="dogp{{ dog.dog_id }}" class="dogPicture" data-dog="{{ dog.dog_id }}">
   <div class="dogIntakeProfile" id="{{ dog.dog_id }}" style="display: none;"><br>
<br>
Name: {{ dog.dog_name }}<br>

Latest Pupdate: <br>
{% for dogshift in recent_dogshifts %}
    {% if dog.dog_id == dogshift.dog_id %}
        {{ dogshift.notes }}      
    {% endif %}
{% endfor %}<br>

Kennel ID: {{ dog.kennel_id }}<br>
Breed: {{ dog.breed }}<br>
Gender: {{ dog.gender }}<br>
Altered: {{ dog.altered }}<br> 
Age: {{ dog.age }}<br>
Intake Date: {{ dog.intake_date }}<br>
<br>
    </div>
</form>


{% endfor %}
{% endblock %}